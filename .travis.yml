env:
  global:
  - COMPOSE_FILE="docker-compose.yml:docker-compose.test.yml"
  - DOCKER_LOGIN=tubbo
  - SOUNDSTORM_HOST=soundstorm.social
  - secure: JbOKS2gQtIaN/JcHU279zdquYfCsgRuTi36RRLv0Sh2x74BORTMhdvnS/pixOkpfkUzYAEiAfVXxhrjIywm7TDICrJ4OAnOu5nwsm2faQL14tsZ8QM21UaL4TYSsk9clUFExZPRL5TlWorH5lIGoWDj1ESz+eEyChJWU/vLHpM7yW8ButMKgXGZfC7q/kcSlPC37x28WGMABf1eHvf7gbuwNu0bXnxyIizBJaif2yY62pkBSXMaz7oPYFcuFza9vWKdA9Cw1ft52x2w11NNZUeeKoJsNmWF3JRVFPdvAdCKPnM8/kswXZQ35K71udTmsZGltNG8ky2ZepugLMoenqn4MCHotPrIaukmAc12k0Fqws1n1cVEaMMA1spWjCJeKaS7dk26NT9qJQVNthgcXrQAlPeMdTUsW7TI80L1Y3mC+p//GRBLpfZhSEkqDb0XfF7i6RiB9mRydC6t8GCspjYGArTOi3czfnp5nbr7R/M3XrKk/HUHDNIozuP1ZG/Sn+VZ7WFNTe2Q360yojViVXgCQot4WAbD9tiYAFQiBzHAosxeEtl/1ZKUTx9OXyZ/enPvb1iQcvfCZ4BdeSqpbWKPxgl76g/SRAp/pXgQ9dXT5mRg1cpwZdm7wzGkdKXEiqfeVOADTcsR3h+02qapZ2P2jX682u7wxAj+ShNEDg9c=
  - secure: fi9so9xAZHmZmjyVloDhPzlaS2YPOcTaM1BydkxiqcGS6PAj9i2zqbk/TT/VtUcceIIqdWsRm1OmTBa2CBDYzEjZTSyDe8Mwpg/c0m4/v+l53WzMsFqjDfmP9YJs3Gv6Ph63mC5Uj6+kaSSkEKfBzEW+nIQ57n5+vTdn8JIQIYsV700/ps9jy6Na3psLW41bInpFoj4a4aPGAiK0wRboQOiYNDzohzI0Q0ZgyN1UmJ6Xm4iXnlLIezsC5Kntqwzxux5bYlEYLJZsAyvdNEebeFe+/vRZ/XmPA3gxmw1NwYMPSMvWY1noCShk/0mS0Y22aBw5b9LB2EF/2/s07+95IgOLeFwx54WaiK/8rV2WwUnO0ZCPIZ0AYAUHYcePL85HgwosSimw8vhqkjPgXajMbdssje8XfZI1tbuBY2KTxgNnu0UKcxNst6TqHoKyxY8Y2K9Buuhr5TWMxJ3/LtJfXJ7x2VsWoABlKX4qtHcmDvHTMyXE7Up06Jj3NR3l5RJBiJH8S1mQCCvDYsv2LMkiQW33rZyrIkYpYbEnMyFv8WPIz194S0EhfjZrQ3cfPXu/lx+XvCxXqiph3/toQEOSr9ldePaliBjwYVhvCeHUjKh7xq1ijsAXaFZDp26wZHnB7LJ06A0RS30+xBzGUWLAxQlSVE9QR/GGTL2AfhY9GbU=
  - secure: BkrreCbd3COLCJly1XgpctHWJCapqlHrePx84hpAAZ9gR5x5I+2hMH8JO7P3MkFFD7UBaT+7Z1phgyRQYzxC4z6WSt61D+HLk0NL1/uIXH4rwKmywlf/Ypj7ZobrkdY/aLmuAFuZKLK9uv5h/BoR46jX0Kmo40gV/pXXlJ2bEsnVGXNdX7dbl4JLbQddSktSUZqPJgAzuClrcP/FyM8AGdBBX61GoxhJ0KZjh7XWOK3GuI/T3e20wGzhQZzBMS34wSdvB6ocsUsexpNl8cR18d343S8EIn42Bt2SSpJW+xCMg7ZK+tfjIADH9IoNyS6rM9+yK9besihtzFAIwmxTNePlEVAMkeIx+JA8Ygzbz461kXdYLppynlIySqj2Q8VNF9Ddvs9t7KZOrPY+JbgLqowEx4XK6OaOu05YooufGAQjNpGGnCWJ0O4LbudWKDWihXbNoP1KJOTWk/Db6a41T6Yqv85WY5kPoemUOAs+2tsCrBDEf7Y4++YNNFzFbk0TZb9cn7XENRvubLhk3haDaQlUt5LldxYKdIJsI11Hj0cFd6TKhQiRn8HxRUMxPUGDVZKydlXYguidbv7uKDuFPU5MRYxAUVxjZa+J1Y1f0CXCYLiAU6y2aU2zjOLSHcX5Kqc6eSyIY/qCWodOdFVBY5RtsoG5U5qwP8SCFITwBec=
services:
- docker
install: make install
script: make ci
after_success: RAILS_ENV=production make
before_deploy:
  - docker login -u $DOCKER_LOGIN -p $DOCKER_PASSWORD
  - docker login -u _ -p $HEROKU_API_KEY
deploy:
- provider: script
  script: make push deploy
  on:
    branch: master
- provider: script
  script: make dist
  on:
    tags: true
