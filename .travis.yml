env:
  global:
  - COMPOSE_FILE="docker-compose.yml:docker-compose.test.yml"
  - secure: iMQuMsO9z1PEarI96djfVnxGyn8kzjHNBU1i1zIQhY2b0C/nHT5YCMH+/NBQ91V2c5cbx3TpbklgkPBTV/3XeUK3M6OIzyMWfQu3t6zCuE/Kx43BglzLXza6Y3rlviJdFlkMwwT7pwFOnLNPCgI7u/9ey9G8OpVXhAZPKDvpX39QlbU7jIn2lGojUocwrTvAcPSubWRMgoMYOt1ijWpA8IUO/dNbzNcuj99phGN2LFexJG65oFHIbdfJADw1gdSObIkghy6mbdKH1fu03dmV/wOqlbp+QJaAH/nMlFL8xD39muFR7tzfWOrblo5McN7eJnrJ1KpicL6g4tW3PnlcdyS4OvsDkKqvlbsp9j8nWt5bNrsRLA+2x8rP3V4UPHFk6kHb1LkBjnqJWmdlp4qB3QxP8DF9IyYNkFfxXy9wpYc7kkCJ7hdu74RJenBBaG4i0/fmKlGAVezLC7ERHb0xqnwDfyXGhJ8qLFtLpMh+bAE5tPtHNNnB61VXVMZvyUyBCRf8dYfr4ytRdmkqq8LtiNqvtoPLK0bpJeg0S4Gw0GJaAqEddd1ciRfdf9TN790S9avAN0tfDcX/zDunFApm2EEYmDNBw0AQaASBFE1hslo9gATmlcZs86XraUj2qL1QHCA3Cm6b3xmXCjNFvL3Jpy/H9UKxUqabrXi5+FvGQkA=
  - secure: qNZ89oaVWzsGwKI7TizGh4XrxbT/cLGn7Rlydv9G5+k+fD1/N1dYHyFWSlz7yeNt0gMXSgLmi6WtrzHe0BRvFGcQhkr2UNG+r2HtB1l4gnaEekvQju7CchhTuTIUQ9SS10K/0kmHtobHQwaPPjrs9y3QIrrdU0c2RKgHKRssj/iHvZg57iblbSBpwPEH1Q8vPhqR3gBiPC3eFmBYd8vfmmpdgh+3PSr2s+ailmec38nnAwFWpNjIEnWOeZy/r+AYkhscTlT5YoRLSoJUwBOKjhOBDaJ7yLtnlLpXdSxzxnP8b/7f8j66O5KnJ/iQTaxgEE8puuTLmkqfo80GRWJ3wC0JjqKam9GuPAF9hC0Icar8EEZp8Oc7DDU2m/2/5r+/Lw6cWQ2/yV2VpYR7WQ6Jiu110lmbKY+jXI5a+FNKN7etdqKUpV5lbjxTe5kEpzBo2klvSRHc7X/bchEiuRX/rD/gBV1gpn6qpcQrDO61zD/lJPYUgjeF7T0y6kyPI+2c2n3lm0z32ma3BqBTyoBEd+iHoJrphIvifPiyBKfM35bJ4iwTCZbtHjNLL/v2Tm06GxMiq8flXm3O6zSg7gd9yTyqC2UkCZIGjSz1KL4+ycVO0ZTh+1BnRQiYaoq39juEGZ/aiqexuCvuVwhotzSw1YjR1od/lwVg3vBaTNxsZBc=
  - secure: rTfMsbZRmlau7BaSyzmk+NViAeThge7E+5DLrNce0wQguaU9elS38VBNz9YMOZA6fryG7NqzpBXNnC1UxbYFe29vW8M+MtnIHgt7HrxypUAwXv9wbeivUX5+BbjHqasyMil5BYqBRgZPpXkWg9Ggr5Ngg1J9dOZ49JTgS0n4LBjUWNpXYR9HkQRfdInQUbo8ykQ2p5WKp6nuyRZDuCt7OyLSR1kOdyXRxpUHE5C3tbuF8t9bXGTL9Ux3vvwECGN6+gFpMoMkpCYepiTcQ6zZDGOlBfJUK+TXLLGJKcyqSCEyjfqZ65tWmvBWmiVLHT54amrfki2ZjXORhtTHQfMcubzamwcuVke1Db9EHjJM7KuvCO9x+ewuHjM6SbZRASGiJOPX3fCwDV6B6ndt4/GTc9T99c5WD+C1hQCcZzzfTezoC55IqljEeuheiU+5IzCaMjFpwy7Dzn/kaYnaBMJv4mh0eitdBn4mvwb323AoeIrkgArCShuFf1fOBi9yFZTxRu6u7EaPMlS8Q8yl/jwVZyBAjE0n846sjuB0UySOQotWBuQwYQq6F8q+VjhQv08dzssVH1VJbIJtuIqseDK2+ibhttXfWbbk0Jxq+poDcHuT2pzgfUetqKo2D3Z8aoaYo8iAyPURAqqHTsc4XBuDJdm1p9wN468S224NeQVpbVg=
  - secure: QwUKCgECKqp3nOR2oUqYc0NuZh8X6VHS2Z5nfqaIczaUWQusxlimEzFEUOL7aLGOSmCJFoIeL6/q+8W542oxtpxjYN13o+IAiqoDv209wulcqZ0RL8pCErPlCEIYG+euQ4/GHPHFK16c7M7ZR6/PXPvNVgxoNQi+BnwXfDygj56fOiKrn+0ggplYvI627oHSEa5sDE5fJ5ByxWqrW7d+6RDh5ItBfKUhgcefVqYzESu8iZYDDRnwfCbiELb451ILhmlif68Gov2R6+CxP3Vao9FMVS03V2olJZ6BNQxGCsNtdLHK3cBjNrJ4wVqDNrZEAXYHqtkdisOKaFXaN4W+/ztLOH9M5DfMEg6jAO8Sp15zE6U815ItKdTwnz3+hIBP4SeXkb9fmb/05dJD91V+WpfTfPyWc3qfdAVaOAfU8w/XLvMdFtCRHuqDI4drDtJochR2J+wvFBgB3o7g9H3+q4h/vBE0xXp3yYRkqjf5CKjZ3rOg4uwZc2ZRZEHxoDlJwqV11g8sbIdeXGOZYuXwvowGHjMLQ/ZhGz+ayK0QWG72wKpbzt9gBAK6+l8VjN3rpWTzg4nnVpcJEc3WQvOIufc6G6LA7V37VOBEsTX0E31Kjhz+KefbiAAt+ZI6VJAInmYW0vg6y8jnLNFz2AiymLmmpBJ9sKYSSr+desePoRM=
  - secure: hFFbBhNoucIeJHW4G0Yam6HMfqrMtCa4GtrlRJccnNyN2qlPzbLfXSbuhIrWwkUlYth3jmpx8JD723h3pFreavkoiFdQiusPUOcbFJWC6EyxAw5YRRXVqXM3+qTkHqfFH9rpv5sEXfYbmJ2x916ctwqgqEuF48tPo8vyh+THZU6UYd3kBgzPI2HZB928vokPx6rQuyuroRZHIdBKjdE8c7zkgEfJIUm066xjaAM5PS5zcS++YHlbKnBen6G8VEp0Ruh/zXowJ+1r0KteCFlv5dRJpYeJIHPteMP8WxXN+Hhn75uRz+3Nm9hthr2A4GFoOafx897Ijdz3y/c/2DqZrvzWRrBbbts8dUoolYsU0PdlIo83M7j4YYDg3fjrWaxhVz3AWyOb8bJBtQfU9mmOHQ5Ie6LL5BQe6Lr24NxYVxSeazKFZwbe4pxYymWGVGQ4tzWGCup6vl/e2UkdZWJnWXjZg+2Te2jbqFPRPtCUUVwrjvPbyhgdI3avg+nLynMw+3oku5WnPnkjkbKk3cLt4b7O6ND1CV8Qx1gXpQPD29o8nJPHXb3Zu1cnnrk5tYl7/5O9g58bX1O2I3QAzLBuzm6Rk1wFdpQneZ6MAJyri0m27vhmtMin7ELDp5XuxqLJFFLV10P58gpEaVnbd8tBcVQvFy96T705kZBfTnNv/A0=
  - secure: NDmPc+YsxXFkPl5OG6v0ke9z0ObGCpdZ7I3kWaAkGnMHaMZ5J3s+mh2yQs66W8cqpD+8fcfZZ8Q2ijzvV8sSVAnenowLKvUizoSnC0dwLttCuK3xIy4NeuZrw0ydlQ1+aCeocManFHEYiJkC89ckQJe4aptoDMJTeuhqbJ+GVqWvsD6GwB08ITXY6GRtJvrDeeOgWu8nC3wDvYDpqQq3mAXAIHcJ/vEq4vrmZdox0Xv5siMehqBHSHhu18GSgcJViFiqZh3ihmBZjkBMDIndLL/xJ/XxMgDaKIoCiuyWqC3khjICYmG3khePvPZRIt11VayDu+ds2y6VufIEXjwNH2/ATwZCnkHKhyakrqyvOkVSoy4UciH1CX3P6kGsjhQQ2lhFGoZ+r+xv9lnc9TB0IG0KZLk+yn5/MUQ4YruoCHfJe6BC4DL1seAVqx6D+vUgGl2CsdSyQB9yoMJKxrLPLv8y9bXM0zGluPfwziwUGRm9f5552AlYzkqSlLMS4ED/vIgT+Pz3/ucGTxh5FBWvAnO6bOeyM31SZbt57F0VX49g6PJmQp5yHqnEcPw2I8/rhaoYNzM0sb+b2WmJ0ifPFIjAu56ooCyNtKO+Y1U01ZLNKNiB+8BiZV2B1hsdzfoXQEu9i0AqmBrqtLk3rJgBcPHY3LrlskYyDRBBfHI6aLY=
  - secure: Qaf+7ibVUO5o5QOU/2wCAPFOtbwswYkzRBU2pTqmablsxSsUK/hgUvMAdUp0XzpS43/thHiZjm+5eYO0JtuFuGV9DaeT1bCHvefPcLyf+EkhwsKm4c6dVSxiBkrxorBUEJRkN8PO6FS6CnmF+PejjduBgmKoW+1fYKDIbOVzGXs1whuviYz9+412PXSh+24/cAfOUO5EsfPQQybkKHuHT024n2/YGyM+vK0z610u6RevlGmDJ66i9HpeWE8c71Mn2Tog+KvnW6QCrziB1J38HOZCZ+PJ9HAGS0luXx0sLLrQ4ICpRUefKx6Ve5k+oaNt0MTmVKQlIQ2eIdoMBmLmxohz/V6BEFNkF1zzmm9nHBeVsvK5i/kcx7LogmWsFHHN3FC8o/aHqmZUTaVUVg12jO9AgDKUfbiJqgDfSOTlETjLFyrtoDIl0YwrwEtu5xMGCJUBBuf9M8dNSAoaPzWYehaI7sUlMNev99xfjVhHTnp6nEkLx0giOu0ExhLPlON4uFAf9uPhcNfsfZ2msnopKW7/UDVLboevgWUoXr7utly9d1v2sBE5qI5BzixcVluVrfO5TxVRdz88NnA0ZVc5Mwpv4JWaGQGXSKnn8Wb3CnqAKvyQCPzGYoWiPm02klSXyZ58tTjD0ivruN81u0ijYbT80l0IKSZXxlef2w0TkhE=
services:
- docker
install: docker-compose run web bin/rails db:setup ci:setup
script:
- docker-compose run web bin/rails test test/**/*_test.rb
- docker-compose run web bin/rails ci:report
after_success: docker-compose -f docker-compose.yml -f docker-compose.production.yml build web
before_deploy:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_LOGIN" --password-stdin
deploy:
- provider: script
  script:
  - docker push weathermen/soundstorm:latest
  on:
    branch: master
# - provider: script
#   script:
#   - docker tag weathermen/soundstorm:latest weathermen/soundstorm:${TRAVIS_TAG}
#   - docker push weathermen/soundstorm:${TRAVIS_TAG}
#   on:
#     tags: true
# - provider: script
#   script:
#   - curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-darwin-amd64-latest
#   - ecs-cli compose -f docker-compose.yml -f docker-compose.production.yml up
