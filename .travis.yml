env:
  global:
  - COMPOSE_FILE="docker-compose.yml:docker-compose.test.yml"
  - DOCKER_LOGIN=tubbo
  - secure: JbOKS2gQtIaN/JcHU279zdquYfCsgRuTi36RRLv0Sh2x74BORTMhdvnS/pixOkpfkUzYAEiAfVXxhrjIywm7TDICrJ4OAnOu5nwsm2faQL14tsZ8QM21UaL4TYSsk9clUFExZPRL5TlWorH5lIGoWDj1ESz+eEyChJWU/vLHpM7yW8ButMKgXGZfC7q/kcSlPC37x28WGMABf1eHvf7gbuwNu0bXnxyIizBJaif2yY62pkBSXMaz7oPYFcuFza9vWKdA9Cw1ft52x2w11NNZUeeKoJsNmWF3JRVFPdvAdCKPnM8/kswXZQ35K71udTmsZGltNG8ky2ZepugLMoenqn4MCHotPrIaukmAc12k0Fqws1n1cVEaMMA1spWjCJeKaS7dk26NT9qJQVNthgcXrQAlPeMdTUsW7TI80L1Y3mC+p//GRBLpfZhSEkqDb0XfF7i6RiB9mRydC6t8GCspjYGArTOi3czfnp5nbr7R/M3XrKk/HUHDNIozuP1ZG/Sn+VZ7WFNTe2Q360yojViVXgCQot4WAbD9tiYAFQiBzHAosxeEtl/1ZKUTx9OXyZ/enPvb1iQcvfCZ4BdeSqpbWKPxgl76g/SRAp/pXgQ9dXT5mRg1cpwZdm7wzGkdKXEiqfeVOADTcsR3h+02qapZ2P2jX682u7wxAj+ShNEDg9c=
  - secure: fi9so9xAZHmZmjyVloDhPzlaS2YPOcTaM1BydkxiqcGS6PAj9i2zqbk/TT/VtUcceIIqdWsRm1OmTBa2CBDYzEjZTSyDe8Mwpg/c0m4/v+l53WzMsFqjDfmP9YJs3Gv6Ph63mC5Uj6+kaSSkEKfBzEW+nIQ57n5+vTdn8JIQIYsV700/ps9jy6Na3psLW41bInpFoj4a4aPGAiK0wRboQOiYNDzohzI0Q0ZgyN1UmJ6Xm4iXnlLIezsC5Kntqwzxux5bYlEYLJZsAyvdNEebeFe+/vRZ/XmPA3gxmw1NwYMPSMvWY1noCShk/0mS0Y22aBw5b9LB2EF/2/s07+95IgOLeFwx54WaiK/8rV2WwUnO0ZCPIZ0AYAUHYcePL85HgwosSimw8vhqkjPgXajMbdssje8XfZI1tbuBY2KTxgNnu0UKcxNst6TqHoKyxY8Y2K9Buuhr5TWMxJ3/LtJfXJ7x2VsWoABlKX4qtHcmDvHTMyXE7Up06Jj3NR3l5RJBiJH8S1mQCCvDYsv2LMkiQW33rZyrIkYpYbEnMyFv8WPIz194S0EhfjZrQ3cfPXu/lx+XvCxXqiph3/toQEOSr9ldePaliBjwYVhvCeHUjKh7xq1ijsAXaFZDp26wZHnB7LJ06A0RS30+xBzGUWLAxQlSVE9QR/GGTL2AfhY9GbU=
  - secure: i6RmN2uGEZF8Gk0VHjb4vmlCeCyvd+9yWf/BZoYt5BiXJR5omB0p8n/ZeW6bqO6DspbGCmY/s4ex7B7zh7gd28wYNNQsnzqHsBqb/IXuylVvgMfxyLe1/YF2zgS7xUNBBhEflo/qgtM529EDCA9IwC7IoFq0TVTR3XwcxV40tjei8RYfvQawXMSLFRomipSavy5y6YUMwc/Yfn9zwuJpI9OkzcFsBm2EjfdShQ/JUiezJ04U+AZvFSMKmRNIUGw1wmYriDLYf2XMaFtEBONpXLT8bUtNG5e0LhOHgyg24cYi9tNPeO9iRToXQbPAdXDJPghtaqIRXNh/XkoOfI4HQl5YSCTcfqAk+Tl1UjWsDNfkYx1kn/lH+zPWLimekvQm1AUHyVfEYdGw5wR+A5nKjhQEQGv21La+s8OyadJ5DObCPugz17m3zTjwJ/VAIbPNmGlyzCrl826de6Xks/18BagP6Nm6D8KECWhgdBuz+uey2dsWjlTPHUF1UOCEOrXYl9UbjyxJOQLpnivQpkHg2MFK+ng2pLfWjR6d6EbJ/ijFa7KshxBtpdLw86RkaoNs7qeiGy2lxCOx7nzlRESBnmXIi5vSV9WxlCmYrvAwOiwp0dTzA9iEyn6yZD0hOFKvvWq4YpPOLibIpD2Aqv9XYD5ceFHmvr8Dw4O5nugy3Ws=
services:
- docker
install: docker-compose run web bin/rails db:setup ci:setup
script:
- docker-compose run web bin/rails test test/**/*_test.rb
- docker-compose run web bin/rails ci:report
after_success: docker-compose -f docker-compose.yml -f docker-compose.production.yml build web
before_deploy: docker login -u $DOCKER_LOGIN -p $DOCKER_PASSWORD
deploy:
- provider: script
  script:
  - docker push weathermen/soundstorm:latest
  on:
    branch: master
