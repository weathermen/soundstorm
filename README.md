# Soundstorm

[![Tests Status](https://github.com/weathermen/soundstorm/workflows/Tests/badge.svg)][ci]
[![Build Status](https://github.com/weathermen/soundstorm/workflows/Build/badge.svg)][ci]
[![Deploy Status](https://github.com/weathermen/soundstorm/workflows/Deploy/badge.svg)][ci]
[![Test Coverage](https://api.codeclimate.com/v1/badges/bc1fd5c8bb8b54b1da49/test_coverage)](https://codeclimate.com/github/weathermen/soundstorm/test_coverage)
[![Maintainability](https://api.codeclimate.com/v1/badges/bc1fd5c8bb8b54b1da49/maintainability)](https://codeclimate.com/github/weathermen/soundstorm/maintainability)

The Federated Social Music Platform.

**Soundstorm** is an audio-oriented federated social network that speaks
[ActivityPub][]. Users can upload their own music, comment on others'
tracks, and like/follow/mention just as in a regular social network.
Since it speaks the same language as federated platforms like
[Mastodon][], Soundstorm can send new track upload posts to users'
followers on the fediverse, allowing them to gain a greater reach than a
conventional social audio service.

## Installation

Soundstorm is distributed as a [Docker image][] for deployment ease. The
reference instance, https://soundstorm.social, uses Amazon ECS for
deployment, but the image is self-contained and can be run on any
infrastructure. This image runs in `RAILS_ENV=production` mode by
default, and comes pre-loaded with compiled assets and everything you'll
need to run a Soundstorm instance in production.

The easiest way to get started (for now) is to clone the repository and
set up locally with Docker Compose:

```bash
$ git clone https://github.com/weathermen/soundstorm.git
$ cd soundstorm
$ rm -f config/credentials.yml.enc # so you can generate your own
$ make install
```

You'll be prompted to create a **config/credentials.yml.enc** file. It
should look something like this:

```yaml
secret_key_base: <something generated by Rails>

# AWS S3 access
aws:
  access_key_id: your access key id
  secret_access_key: your secret access key
  s3_bucket_name: name of your aws s3 bucket
  region: the aws region

# Hostname of this Soundstorm instance
host: hostname of your instance

# Initial admin user data
admin_user:
  name: your username
  email: your email address
  password: your password

# SMTP credentials for sending out emails
smtp:
  user_name: username to auth with
  password: password to auth with
  address: smtp address
```

Make sure to keep the **config/master.key** available in a password
manager to share with your teammates. It will not be committed to the
repo.

Once the Rails app has finished installing, you'll be able to access it
at <http://localhost:3000>!

## Development

The above goes into installing Soundstorm for real-world use, but you
may also want to contribute to the project in some way. Developing on
Soundstorm also requires the use of Docker.

First, clone the repository:

```bash
$ git clone https://github.com/weathermen/soundstorm.git
$ cd soundstorm
```

You can now run the install task to build the image and set up its
database:

```bash
$ make install
```

This will prompt you to enter credentials, which you may or may not want
to do, it's OK to leave this blank for now because all it really needs
is to generate that brand new `secret_key_base` and your
`config/master.key`.

You can now start all services:

```bash
$ make start
```

Once the web app loads, browse to <http://localhost:3000> and log in with
username **admin** and password **Password1!**. This is configurable by
adding the following to your credentials:

```yaml
admin:
  name: admin
  password: Password1
```

...then running:

```bash
$ make mostlyclean install
```

to reinstall the database and its seeds.

For more information on making contributions to this project, read the
[contributing guide][].

## Deployment

Soundstorm is designed to be deployed to [Kubernetes][], using the
[Docker Compose API][] to do a lot of the heavy lifting and translation
between our compose configuration and the various Kubernetes resources
that it can create.

After creating a production cluster on your cloud of choice, and
configuring `kubectl` to work with said production cluster, you can run
the following command to provision the cluster for use with Docker Stack
by running this command:

```bash
$ make compose
```

Once that's all done, make sure your master key is in
**config/master.key** and your credentials are in
**config/credentials.yml.enc**, then deploy the application by running:

```bash
$ make deploy
```

The former of the two commands is only required when first setting up
your cluster, for every subsequent deployment, `make deploy` is all
you'll need to run.

[ActivityPub]: https://www.w3.org/TR/activitypub/
[Mastodon]: https://joinmastodon.org
[Docker]: https://www.docker.com/
[Docker image]: https://cloud.docker.com/u/weathermen/repository/docker/weathermen/soundstorm
[puma-dev]: https://github.com/puma/puma-dev
[ci]: https://github.com/weathermen/soundstorm/actions
